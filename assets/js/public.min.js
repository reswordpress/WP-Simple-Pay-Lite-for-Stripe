/*! WP Simple Pay Lite for Stripe - 2.0.9
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var simpayApp={};!function(i){"use strict";var e;simpayApp={spFormElList:{},spFormData:{},spStripeData:{},init:function(){e=i(document.body),simpayApp.spFormElList=e.find(".simpay-checkout-form"),simpayApp.spFormElList.each(function(){var s=i(this);simpayApp.setupCoreForm(s),e.trigger("simpaySetupCoreForm",[s])}),e.trigger("simpayLoaded")},isStripeCheckoutForm:function(i){return void 0===i.formDisplayType||"custom_fields_stripe_checkout"===i.formDisplayType},setupCoreForm:function(s){var n=s.data("simpay-form-id"),p=simplePayForms[n],a=i.extend({},p.form.integers,p.form.bools,p.form.strings);a.formId=n,a.finalAmount=a.amount,a.quantity=1,a.stripeParams=i.extend({},p.stripe.strings,p.stripe.bools),a.oldPanelLabel=void 0!==a.stripeParams.panelLabel?a.stripeParams.panelLabel:"",e.trigger("simpayCoreFormVarsInitialized",[s,a]),spShared.debugLog("formData.formDisplayType",a.formDisplayType),simpayApp.isStripeCheckoutForm(a)&&simpayApp.setupStripeCheckout(s,a),simpayApp.spFormData[n]=a,e.trigger("simpayBindCoreFormEventsAndTriggers",[s,a])},setupStripeCheckout:function(i,e){var s=null;i.find(".simpay-payment-btn").length&&(s=StripeCheckout.configure({key:e.stripeParams.key,token:function(s,n){i.find(".simpay-stripe-token").val(s.id),i.find(".simpay-stripe-email").val(s.email),n&&simpayApp.handleStripeShippingArgs(i,n);i.find(".simpay-payment-btn").prop("disabled",!0).find("span").text(e.loadingText),i.off("submit",[i,e]),i.submit()},opened:function(){},closed:function(){}}));i.find(".simpay-payment-btn").on("click.simpayPaymentBtn",function(n){n.preventDefault(),i.trigger("simpayBeforeStripePayment",[i,e]),spShared.debugLog("Launch Stripe Checkout overlay.",e),simpayApp.setCoreFinalAmount(i,e),e.stripeParams.amount=parseInt(e.finalAmount),spShared.debugLog("stripeParams",e.stripeParams),s.open(e.stripeParams)})},handleStripeShippingArgs:function(i,e){e.shipping_name&&i.find(".simpay-shipping-name").val(e.shipping_name),e.shipping_address_country&&i.find(".simpay-shipping-country").val(e.shipping_address_country),e.shipping_address_zip&&i.find(".simpay-shipping-zip").val(e.shipping_address_zip),e.shipping_address_state&&i.find(".simpay-shipping-state").val(e.shipping_address_state),e.shipping_address_line1&&i.find(".simpay-shipping-address-line1").val(e.shipping_address_line1),e.shipping_address_city&&i.find(".simpay-shipping-city").val(e.shipping_address_city)},setCoreFinalAmount:function(i,s){var n=s.amount;spShared.debugLog("setCoreFinalAmount",s),s.finalAmount=n.toFixed(0),e.trigger("simpayFinalizeCoreAmount",[i,s]),i.find(".simpay-amount").val(s.finalAmount)},formatMoney:function(i){var e,s="%s%v";return i=simpayApp.convertFromCents(i),"left_space"===spGeneral.strings.currencyPosition?s="%s %v":"right"===spGeneral.strings.currencyPosition?s="%v%s":"right_space"===spGeneral.strings.currencyPosition&&(s="%v %s"),e={symbol:spGeneral.strings.currencySymbol,decimal:spGeneral.strings.decimalSeparator,thousand:spGeneral.strings.thousandSeparator,precision:spGeneral.integers.decimalPlaces,format:s},accounting.formatMoney(i,e)},convertFromCents:function(i){return spGeneral.booleans.isZeroDecimal?i:(i/100).toFixed(2)},convertToCents:function(i){return spGeneral.booleans.isZeroDecimal?i:100*i}},i(document).ready(function(i){simpayApp.init()})}(jQuery);