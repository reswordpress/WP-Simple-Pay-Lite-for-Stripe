/*! WP Simple Pay Lite for Stripe - 2.0.9
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var simpayApp={};!function(i){"use strict";var s;simpayApp={spFormElList:{},spFormData:{},spStripeData:{},init:function(){s=i(document.body),simpayApp.spFormElList=s.find(".simpay-checkout-form"),simpayApp.spFormElList.each(function(){var n=i(this);simpayApp.setupCoreForm(n),s.trigger("simpaySetupCoreForm",[n])}),s.trigger("simpayLoaded")},isStripeCheckoutForm:function(i){return void 0===i.formDisplayType||"custom_fields_stripe_checkout"===i.formDisplayType},setupCoreForm:function(n){var e=n.data("simpay-form-id"),a=simplePayForms[e],t=i.extend({},a.form.integers,a.form.bools,a.form.strings);t.formId=e,t.finalAmount=t.amount,t.quantity=1,t.stripeParams=i.extend({},a.stripe.strings,a.stripe.bools),t.oldPanelLabel=void 0!==t.stripeParams.panelLabel?t.stripeParams.panelLabel:"",t.submitBtnClass="simpay-payment-btn",s.trigger("simpayCoreFormVarsInitialized",[n,t]),spShared.debugLog("formData.formDisplayType",t.formDisplayType),simpayApp.isStripeCheckoutForm(t)&&simpayApp.setupStripeCheckout(n,t),simpayApp.spFormData[e]=t,s.trigger("simpayBindCoreFormEventsAndTriggers",[n,t])},setupStripeCheckout:function(i,s){var n=null;i.find("."+s.submitBtnClass).length&&(n=StripeCheckout.configure({key:s.stripeParams.key,token:function(n,e){!function(n,e){var a=i.find("."+s.submitBtnClass);i.find(".simpay-stripe-token").val(n.id),i.find(".simpay-stripe-email").val(n.email),e&&simpayApp.handleStripeShippingArgs(i,e);a.prop("disabled",!0).find("span").text(s.loadingText),i.off("submit"),i.submit()}(n,e)},opened:function(){},closed:function(){}}));i.on("submit",function(e){e.preventDefault(),s.isValid=!0,i.trigger("simpayBeforeStripePayment",[i,s]),s.isValid&&(simpayApp.setCoreFinalAmount(i,s),s.stripeParams.amount=parseInt(s.finalAmount),n.open(s.stripeParams))})},handleStripeShippingArgs:function(i,s){s.shipping_name&&i.find(".simpay-shipping-name").val(s.shipping_name),s.shipping_address_country&&i.find(".simpay-shipping-country").val(s.shipping_address_country),s.shipping_address_zip&&i.find(".simpay-shipping-zip").val(s.shipping_address_zip),s.shipping_address_state&&i.find(".simpay-shipping-state").val(s.shipping_address_state),s.shipping_address_line1&&i.find(".simpay-shipping-address-line1").val(s.shipping_address_line1),s.shipping_address_city&&i.find(".simpay-shipping-city").val(s.shipping_address_city)},setCoreFinalAmount:function(i,n){var e=n.amount;spShared.debugLog("setCoreFinalAmount",n),n.finalAmount=accounting.unformat(accounting.toFixed(e,0)),s.trigger("simpayFinalizeCoreAmount",[i,n]),i.find(".simpay-amount").val(n.finalAmount)},formatMoney:function(i){var s,n="%s%v";return i=simpayApp.convertFromCents(i),"left_space"===spGeneral.strings.currencyPosition?n="%s %v":"right"===spGeneral.strings.currencyPosition?n="%v%s":"right_space"===spGeneral.strings.currencyPosition&&(n="%v %s"),s={symbol:spGeneral.strings.currencySymbol,decimal:spGeneral.strings.decimalSeparator,thousand:spGeneral.strings.thousandSeparator,precision:spGeneral.integers.decimalPlaces,format:n},accounting.formatMoney(i,s)},convertFromCents:function(i){return spGeneral.booleans.isZeroDecimal?i:accounting.unformat(accounting.toFixed(i/100,2))},convertToCents:function(i){return spGeneral.booleans.isZeroDecimal?i:100*i}},i(document).ready(function(i){simpayApp.init()})}(jQuery);